<!DOCTYPE html>
<html>
  <head>
    <title>Prediction</title>
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
      integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" type="text/css" href="../static/css/style.css" />
  </head>
  <body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <script type="text/javascript">
      var ids = 1;
      function add() {
        var form = document.getElementById("main");
        var coldiv = document.createElement("div");
        coldiv.class = "colums";
        coldiv.style =
          "display:flex;justify-content: space-between;flex-direction: row;flex-wrap: wrap;";
        var div1 = document.createElement("div");
        div1.class = "item";
        div1.style = "position:relative;margin:10px 0;width:48%;";
        var div2 = document.createElement("div");
        div2.class = "item";
        div2.style = "position:relative;margin:10px 0;width:48%;";
        var key = document.createElement("input");
        var keyl = document.createElement("lable");
        keyl.innerHTML = "Key  *";
        key.setAttribute("type", "text");
        key.setAttribute("id", "key" + ids);
        key.setAttribute("style", "width: calc(100% - 10px);");
        var value = document.createElement("input");
        var valuel = document.createElement("lable");
        valuel.innerHTML = "Value  *";
        value.setAttribute("type", "text");
        value.setAttribute("id", "value" + ids);
        value.setAttribute("style", "width: calc(100% - 10px);");
        div1.appendChild(keyl);
        div1.appendChild(key);
        div2.appendChild(valuel);
        div2.appendChild(value);

        coldiv.appendChild(div1);
        coldiv.appendChild(div2);
        form.appendChild(coldiv);

        ids += 1;
        // console.log(ids);
      }
      function handleSubmit(e) {
        // console.log(e);
        e.preventDefault();
        // console.log(ids);
        var username = document.getElementById("username").value;
        var url = "/predict/" + username + "?";
        for (var i = 0; i < ids; i++) {
          var key = document.getElementById("key" + i).value;
          var values = document.getElementById("value" + i).value;
          url = url + key + "=" + values + "&";
        }
        var pfn = document.getElementById("pfn").value;
        var pfl = document.getElementById("pfl").value;
        url += "pred_filename=" + pfn + "&pred_filelocation=" + pfl;
        // console.log(url);
        const xhttp = new XMLHttpRequest();
        xhttp.onload = function () {
          document.getElementById("demo").innerHTML =
            "Prediction output is " + this.responseText;
        };
        xhttp.open("GET", url);
        xhttp.send();
      }
    </script>
    <div class="testbox">
      <form id="myForm">
        <div id="main">
          <div class="banner">
            <img src="../static/image/bg.jpg" />
            <h1>PREDICTION</h1>
          </div>
          <div class="colums">
            <div class="item">
              <label> Username : <span>*</span></label>
              <input id="username" type="text" name="user" required />
            </div>
          </div>
          <div class="colums">
            <div class="item">
              <label> Prediction File Location<span>*</span></label>
              <input id="pfl" type="text" name="pfl" value="" />
            </div>
            <div class="item">
              <label> Prediction File name (without .py)<span>*</span></label>
              <input id="pfn" type="text" name="pfn" value="prediction" />
            </div>
          </div>
          <div class="colums">
            <div class="item">
              <label> KEY<span>*</span></label>
              <input id="key0" type="text" name="key0" required />
            </div>
            <div class="item">
              <label> Value<span>*</span></label>
              <input id="value0" type="text" name="value0" required />
            </div>
          </div>
        </div>
        <div class="btn-block">
          <input
            class="btns"
            type="button"
            value="Add Key/Value"
            onclick="add()"
          />
        </div>

        <div class="btn-block">
          <input class="btns" type="submit" value="Submit" />
        </div>
        <label
          ><p id="demo" style="font-size: large; font-weight: bold"></p
        ></label>
      </form>
    </div>
  </body>
  <script>
    var form = document.getElementById("myForm");
    form.addEventListener("submit", handleSubmit);
  </script>
</html>
